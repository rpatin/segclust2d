<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running Segmentation/Clustering with segclust2d • segclust2d</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running Segmentation/Clustering with segclust2d">
<meta property="og:description" content="segclust2d">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">segclust2d</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/explore_outputs.html">Exploring Outputs from segclust2d</a>
    </li>
    <li>
      <a href="../articles/preparing_data.html">Preparing data for Segmentation/Clustering with segclust2d</a>
    </li>
    <li>
      <a href="../articles/run_segclust2d.html">Running Segmentation/Clustering with segclust2d</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rpatin/segclust2d/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="run_segclust2d_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running Segmentation/Clustering with segclust2d</h1>
                        <h4 class="author">R. Patin</h4>
            
            <h4 class="date">2021-09-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rpatin/segclust2d/blob/master/vignettes/run_segclust2d.Rmd"><code>vignettes/run_segclust2d.Rmd</code></a></small>
      <div class="hidden name"><code>run_segclust2d.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rpatin/segclust2d">segclust2d</a></span><span class="op">)</span></code></pre></div>
<p>The package <code>segclust2d</code> provides access to two different method:</p>
<ul>
<li>It can perform a <a href="#segmentation">segmentation</a> of the time-series into homogeneous segments. A typical case is the identification of home-range behaviour.</li>
<li>It can also perform an integrated classification of those segments into clusters of homogeneous behaviour through a <a href="#segmentation-clustering">segmentation/clustering</a> algorithm. This is generally used to identify behavioural modes.</li>
</ul>
<p>Input data are here <code>data.frame</code> (shown in the first examples), but it can also be a <code>Move</code> object, a <code>ltraj</code> object (from package <code>adehabitatLT</code>) or a <code>sftraj</code> object, both shown in section <a href="https://rpatin.github.io/segclust2d/articles/preparing_data.html">Preparing data for Segmentation/Clustering with segclust2d</a></p>
<div id="presentation-of-data-sets" class="section level1">
<h1 class="hasAnchor">
<a href="#presentation-of-data-sets" class="anchor"></a>Presentation of data sets</h1>
<div id="simulshift-three-successive-home-range-shifts" class="section level2">
<h2 class="hasAnchor">
<a href="#simulshift-three-successive-home-range-shifts" class="anchor"></a>simulshift: three successive home-range shifts</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">simulshift</span><span class="op">)</span></code></pre></div>
<p>Here we will load a test dataset: <code>simulshift</code>, containing a simulation of home-range behaviour with two shifts. It is a data.frame with two columns for coordinates : x and y. We can now run a simple segmentation with this dataset to find the different home-ranges.</p>
<div class="figure">
<img src="run_segclust2d_files/figure-html/plot%20simulshift-1.png" alt="`simulshift`: simulation of movement within three successive home-range. Data shown after subsampling by 100." width="480"><p class="caption">
<code>simulshift</code>: simulation of movement within three successive home-range. Data shown after subsampling by 100.
</p>
</div>
</div>
<div id="simulmode-a-simulation-with-three-movement-modes" class="section level2">
<h2 class="hasAnchor">
<a href="#simulmode-a-simulation-with-three-movement-modes" class="anchor"></a>simulmode: a simulation with three movement modes</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">simulmode</span><span class="op">)</span>
<span class="va">simulmode</span><span class="op">$</span><span class="va">abs_spatial_angle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">simulmode</span><span class="op">$</span><span class="va">spatial_angle</span><span class="op">)</span>
<span class="va">simulmode</span> <span class="op">&lt;-</span> <span class="va">simulmode</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">simulmode</span><span class="op">$</span><span class="va">abs_spatial_angle</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<p><code>simulmode</code> is an example dataset containing a movement simulation with three different movement mode. It is a data.frame with 11 columns, with coordinates and several covariates. In addition to loading we calculated here the absolute value for the turning angle at constant step length (here called <code>spatial_angle</code>). We also checked the data for missing value.</p>
<div class="figure">
<img src="run_segclust2d_files/figure-html/map%20simulmode-1.png" alt="`simulmode`: simulation of movement with three different behavioural modes." width="480"><p class="caption">
<code>simulmode</code>: simulation of movement with three different behavioural modes.
</p>
</div>
</div>
</div>
<div id="segmentation" class="section level1">
<h1 class="hasAnchor">
<a href="#segmentation" class="anchor"></a>Segmentation</h1>
<div id="setting-segmentation-parameters-" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-segmentation-parameters-" class="anchor"></a>Setting <code>segmentation()</code> parameters.</h2>
<div id="required-lmin-minimum-length-of-a-segment" class="section level3">
<h3 class="hasAnchor">
<a href="#required-lmin-minimum-length-of-a-segment" class="anchor"></a>Required: <code>lmin</code>: minimum length of a segment</h3>
<p>To run the <code><a href="../reference/segmentation.html">segmentation()</a></code> function, argument <code>lmin</code> needs to be provided. <code>lmin</code> is the minimum length of a segment. It is has to be set not only to speed up the algorithm, but also, more fundamentally, to prevent over‐segmenting, based on biological considerations. For example, setting <code>lmin</code> to a value of a few weeks when analysing locational time series will prevent the algorithm from considering an area exploited only for a few days, corresponding to foray outside the usual home range or to stopover during migration, as a distinct home range. Similarly, setting <code>lmin</code> to a value long enough (depending on the species) when looking for changes of behavioural modes will force the algorithm to assign a given behavioural bout to a given mode even when it is interspersed by ephemeral events related to another behaviour (e.g. a long transit with opportunistic short feeding events on the move will be considered as a single transit phase).</p>
<p>Statistically, <code>lmin</code> cannot be <code>&lt;5</code>, because of the need to estimate variances for each segment. To avoid such case, the program will fix lmin to a minimum of <code>5</code>.</p>
</div>
<div id="optional-kmax-the-maximum-number-of-segments-" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-kmax-the-maximum-number-of-segments-" class="anchor"></a>Optional: <code>Kmax</code>: the maximum number of segments.</h3>
<p>By default, <code>Kmax</code> will be set to <code>0.75*floor(n/lmin)</code>, with <code>n</code> the number of observations, so you can omit this argument. You can however provide a different value, as large value may compromise speed or selection of optimal number of segments. See section <a href="#changing-kmax-1">Changing Kmax</a> for more advices.</p>
</div>
<div id="optional-seg-var" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-seg-var" class="anchor"></a>Optional: <code>seg.var</code>
</h3>
<p>You can specify the variables to be segmented using argument <code>seg.var</code>. By default, function segmentation will use variables <code>x</code> and <code>y</code> for a data.frame or use the coordinates for <code>move</code>, <code>ltraj</code> and <code>sftraj</code> objects.</p>
</div>
<div id="optional-scale-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-scale-variable" class="anchor"></a>Optional: <code>scale.variable</code>
</h3>
<p>The function allow rescaling of variable with argument <code>scale.variable</code>. Rescaling sets variable in <code>seg.var</code> to a mean of 0 and a variance of 1. It is recommended if variables chosen for segmentation are of different nature (e.g. speed and turning angle). It is therefore inadvisable for segmentation of coordinates to identify home-ranges. By default <code><a href="../reference/segmentation.html">segmentation()</a></code> disable rescaling and sets <code>scale.variable = FALSE</code>.</p>
</div>
<div id="optional-diag-var" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-diag-var" class="anchor"></a>Optional: <code>diag.var</code>
</h3>
<p><code><a href="../reference/segmentation.html">segmentation()</a></code> use variables provided in <code>seg.var</code> and automatically produces summary statistics for each variable and each segments (mean and standard deviation). In case you want summary statistics for other variables than <code>seg.var</code> you can specify them in <code>diag.var</code>. By default <code>diag.var</code> is set to <code>seg.var</code>.</p>
</div>
<div id="optional-order-var" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-order-var" class="anchor"></a>Optional: <code>order.var</code>
</h3>
<p><code>order.var</code> through which variables segments should be ordered when asked so in some of the output functions (see section <a href="https://rpatin.github.io/segclust2d/articles/explore_outputs.html">Exploring Outputs from segclust2d</a> for details.). By default <code>order.var</code> is set to <code>seg.var[1]</code></p>
</div>
<div id="deprecated-type-coord-names" class="section level3">
<h3 class="hasAnchor">
<a href="#deprecated-type-coord-names" class="anchor"></a>Deprecated: <code>type</code>, <code>coord.names</code>
</h3>
<p>Older version of <code>segclust2d</code> had different arguments, now deprecated. <code>type</code> was either <code>"home-range"</code> or <code>"behaviour"</code>, which provided different default arguments:</p>
<ul>
<li>
<code>type = "home-range"</code> was associated with <code>scale.variable = FALSE</code> and performed a segmentation based on the variables proposed as <code>coord.names</code>. Default value was <code>coord.names = c("x","y")</code>.</li>
<li>
<code>type = "behaviour"</code> was associated with, <code>scale.variable = TRUE</code> and performed a segmentation based on the variables proposed as <code>seg.var</code>, with no default value.</li>
</ul>
<p>From version 0.3.0 and forward, those argument were removed so that the functions now work only with arguments <code>scale.variable</code> and <code>seg.var</code>. Using the arguments <code>type</code> makes the function fail and triggers message explaining the required changes:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df.seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentation.html">segmentation</a></span><span class="op">(</span><span class="va">simulshift</span>, 
                       type <span class="op">=</span> <span class="st">"home-range"</span>,
                       lmin <span class="op">=</span> <span class="fl">300</span>, Kmax <span class="op">=</span> <span class="fl">10</span>,
                       subsample_by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; x Argument type is deprecated and should not be used
#&gt; x Argument coord.names is deprecated and should not be used
#&gt; → Please use instead seg.var = c("x", "y") and scale.variable = FALSE</code></pre>
</div>
</div>
<div id="running-segmentation" class="section level2">
<h2 class="hasAnchor">
<a href="#running-segmentation" class="anchor"></a>Running <code>segmentation()</code>
</h2>
<p><code><a href="../reference/segmentation.html">segmentation()</a></code> uses a Dynamic Programming algorithm that finds the best segmentation given a number of segment. The function runs the dynamic programming for each number of segment <code>&lt;Kmax</code>. As a result, the optimal segmentation is associated with a likelihood value for each number of segment. Section <a href="#different-running-configurations">Different running configurations</a> show several exemples of running <code><a href="../reference/segmentation.html">segmentation()</a></code> with different options. Section <a href="#selecting-the-number-of-segments">Selecting the number of segments</a> discuss about the selection of the number of segments using either Lavielle’s criterium or graphical explorations.</p>
<div id="different-running-configurations" class="section level3">
<h3 class="hasAnchor">
<a href="#different-running-configurations" class="anchor"></a>Different running configurations</h3>
<p>In this section we will try different ways of calling the <code><a href="../reference/segmentation.html">segmentation()</a></code> function. Minimal call should countains the data concerned (here the dataframe <code>simulshift</code>) and argument <code>lmin</code>. The function will automatically complete the missing argument with default values and communicate about it (not shown here).</p>
<p><em><code>subsample_by</code> argument is described in section <a href="https://rpatin.github.io/segclust2d/articles/preparing_data.html#subsampling">Subsampling</a></em></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shift_seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentation.html">segmentation</a></span><span class="op">(</span><span class="va">simulshift</span>, 
                          lmin <span class="op">=</span> <span class="fl">240</span>,
                          subsample_by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
<p>It is however advised to give a more reasonable ‘Kmax’ value to decrease calculation time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shift_seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentation.html">segmentation</a></span><span class="op">(</span><span class="va">simulshift</span>,
                          lmin <span class="op">=</span> <span class="fl">240</span>, Kmax <span class="op">=</span> <span class="fl">25</span>,
                          subsample_by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
<p>There is a check to ensure that <code>lmin*Kmax &lt; n</code> with <code>n</code> the number of data. If you provided inadequate values, <code>Kmax</code> will be adjusted to an appropriate value if possible and you should get a message like this:</p>
<pre><code>#&gt; ! Adjusting Kmax so that lmin*Kmax &lt; nrow(x). Now, Kmax = 25</code></pre>
<p>If not possible you will get an error and this message:</p>
<pre><code>#&gt; x lmin*Kmax &gt; nrow(x) and Kmax cannot be adjusted. Please provide lower values for lmin
#&gt; Error in eval(expr, envir, enclos): lmin*Kmax &gt; nrow(x)</code></pre>
<p>By default the function is looking for column <code><a href="https://rdrr.io/r/base/c.html">c(x,y)</a></code> or the coordinates (in the case of a <code>Move</code> or a <code>ltraj</code> object). Alternatively the user can provide its own variable, depending on its aim:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shift_seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentation.html">segmentation</a></span><span class="op">(</span><span class="va">simulshift</span>,
                          seg.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,
                          lmin <span class="op">=</span> <span class="fl">240</span>, Kmax <span class="op">=</span> <span class="fl">25</span>,
                          subsample_by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
</div>
<div id="selecting-the-number-of-segments" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-the-number-of-segments" class="anchor"></a>Selecting the number of segments</h3>
<p>Once the segmentation have been successfully run. A summary like this will appear:</p>
<pre><code>#&gt; ✓ Best segmentation estimated with 3 segments, according to Lavielle's criterium
#&gt; Other number of segment may be selected by looking for likelihood breaks with
#&gt; plot_likelihood()
#&gt; Results of the segmentation may be explored with plot() and segmap()</code></pre>
<p>By default, the algorithm choose the number of segment given a criterium developed by Marc Lavielle based on the value of the second derivative of the penalized likelihood. This criterium use a threshold value of <code>S = 0.75</code>, but a different threshold can be specified to <code><a href="../reference/segmentation.html">segmentation()</a></code> if need be.</p>
<p>As stated it is important to check that the number of segment selected correspond to a clear break in log-likelihood and if it is not the case to select a better value. This can be checked with <code>plot_likelihood</code> that shows the log-likelihood of the best segmentation versus the number of segments and highlights the one chosen with Lavielle’s criterium. The likelihood should show an increasing curve with a clear breakpoints for the optimal number of segment. Note that with real data breaks are often less clear than for that example. An artifactual decrease of likelihood can happen for large number of segment when Kmax is too high (close to <code>n/lmin</code>) and correspond generally to an oversegmentation (in such case, Kmax should be decreased).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/segmentation-class.html">plot_likelihood</a></span><span class="op">(</span><span class="va">shift_seg</span><span class="op">)</span></code></pre></div>
<p><img src="run_segclust2d_files/figure-html/plot_likelihood%20example-1.png" width="384"></p>
<p>Another exemple on the <code>simulmode</code> dataset show a situation where the number of segment automatically selected by Lavielle’s criterium is 1, despite a (relatively) clear break in the likelihood at <code>nseg = 15</code>. In such case it is of paramount importance to explore the log-likelihood to confirm or select an appropriate number of segments.</p>
<p><em>Note that in this case the problem in the selection of the number of segment would have been avoided by setting <code>Kmax = 25</code>. For Lavielle’s criterium to work properly <code>Kmax</code> should be larger enough than your expected number of segment.</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">mode_seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segmentation.html">segmentation</a></span><span class="op">(</span><span class="va">simulmode</span>,
                          lmin <span class="op">=</span> <span class="fl">10</span>, Kmax <span class="op">=</span> <span class="fl">20</span>,
                         seg.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speed"</span>,<span class="st">"abs_spatial_angle"</span><span class="op">)</span>,
                          scale.variable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="../reference/segmentation-class.html">plot_likelihood</a></span><span class="op">(</span><span class="va">mode_seg</span><span class="op">)</span></code></pre></div>
<p><img src="run_segclust2d_files/figure-html/plot_likelihood%20mode_seg-1.png" width="384"></p>
</div>
</div>
</div>
<div id="segmentation-clustering" class="section level1">
<h1 class="hasAnchor">
<a href="#segmentation-clustering" class="anchor"></a>Segmentation-Clustering</h1>
<p>We will now run the joint segmentation/clustering <code><a href="../reference/segclust.html">segclust()</a></code> function on the simulmode data to identify the different behavioural modes. As with <code><a href="../reference/segmentation.html">segmentation()</a></code>, you can specify the variables to be segmented using argument <code>seg.var</code>.</p>
<div id="setting-segclust-parameters-" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-segclust-parameters-" class="anchor"></a>Setting <code>segclust()</code> parameters.</h2>
<p><code><a href="../reference/segclust.html">segclust()</a></code> share most of its parameter with <code><a href="../reference/segmentation.html">segmentation()</a></code> so you can read section <a href="#setting-segmentation-parameters--1">Setting <code>segmentation()</code> parameters.</a> for the parameters missing description here. The only additional parameter is the number of cluster to be tested.</p>
<div id="required-ncluster-the-number-of-cluster" class="section level3">
<h3 class="hasAnchor">
<a href="#required-ncluster-the-number-of-cluster" class="anchor"></a>Required: <code>ncluster</code>: the number of cluster</h3>
<p><code>ncluster</code> is an argument required for <code><a href="../reference/segclust.html">segclust()</a></code>. The user can provide a vector of values or a single value. The algorithm provides a BIC-criterium to select the number of cluster, although it is advised to select it based on biological knowledge.</p>
</div>
</div>
<div id="running-segclust" class="section level2">
<h2 class="hasAnchor">
<a href="#running-segclust" class="anchor"></a>Running <code>segclust()</code>
</h2>
<div id="different-running-configurations-1" class="section level3">
<h3 class="hasAnchor">
<a href="#different-running-configurations-1" class="anchor"></a>Different running configurations</h3>
<p>In this section we will try different ways of calling the <code><a href="../reference/segclust.html">segclust()</a></code> function. Minimal call should contains the data concerned (here the dataframe <code>simulmode</code>) as well as argument <code>lmin</code> and <code>ncluster</code> and <code>seg.var</code>. The function will automatically complete the missing argument with default values and communicate about it (not shown here).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mode_segclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segclust.html">segclust</a></span><span class="op">(</span><span class="va">simulmode</span>,
                          Kmax <span class="op">=</span> <span class="fl">20</span>, lmin<span class="op">=</span><span class="fl">10</span>, 
                          ncluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,
                          seg.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speed"</span>,<span class="st">"abs_spatial_angle"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Additionally it is advised to scale the variables used to a mean of 0 and a variance of 1. This will automatically be done for <code><a href="../reference/segclust.html">segclust()</a></code>, but can also be specified explicitly:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mode_segclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segclust.html">segclust</a></span><span class="op">(</span><span class="va">simulmode</span>,
                          Kmax <span class="op">=</span> <span class="fl">20</span>, lmin<span class="op">=</span><span class="fl">10</span>, 
                          ncluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,
                          seg.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speed"</span>,<span class="st">"abs_spatial_angle"</span><span class="op">)</span>,
                          scale.variable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="selecting-the-number-of-cluster-and-segment-" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-the-number-of-cluster-and-segment-" class="anchor"></a>Selecting the number of cluster and segment.</h3>
<p>Once the segmentation/clustering have been successfully run. A summary like this will appear:</p>
<pre><code>#&gt; ✓ Best segmentation/clustering estimated with 3 cluster and 15 segments according to BIC
#&gt; → Number of cluster should preferentially be selected according to biological
#&gt; knowledge. Exploring the BIC plot with plot_BIC() can also provide advice to
#&gt; select the number of cluster.
#&gt; → Once number of cluster is selected, the number of segment should be selected
#&gt; according to BIC.
#&gt; → Results of the segmentation/clustering may further be explored with plot()
#&gt; and segmap()</code></pre>
<p>As stated, the number of cluster should preferentially be selected based on biological knowledge. Exploration of the BIC-based penalized log-likelihood can also help selecting an appropriate number of cluster, with the function <code><a href="../reference/segmentation-class.html">plot_BIC()</a></code>. Best-case scenario is as below, the BIC show a steep increase up to a maximum and a slow decrease after the optimum and one number of cluster is clearly above the others.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/segmentation-class.html">plot_BIC</a></span><span class="op">(</span><span class="va">mode_segclust</span><span class="op">)</span></code></pre></div>
<p><img src="run_segclust2d_files/figure-html/plot_BIC-1.png" width="768"></p>
<p>With real data it also happens that more cluster always improve the penalized-likelihood so it will be a poor indication of the appropriate number of cluster. Such situation may be shown with our dataset <code>simulmode</code> indeed, if we allow the number of cluster to be tested between 2 and 5 instead of a maximum at three, we obtain the following BIC curve:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mode_segclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segclust.html">segclust</a></span><span class="op">(</span><span class="va">simulmode</span>,
                          Kmax <span class="op">=</span> <span class="fl">20</span>, lmin<span class="op">=</span><span class="fl">10</span>, 
                          ncluster <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>,
                          seg.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"speed"</span>,<span class="st">"abs_spatial_angle"</span><span class="op">)</span>,
                          scale.variable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="../reference/segmentation-class.html">plot_BIC</a></span><span class="op">(</span><span class="va">mode_segclust</span><span class="op">)</span></code></pre></div>
<p><img src="run_segclust2d_files/figure-html/simulmode%20plot%20BIC%20cluster%202-5-1.png" width="768"></p>
<p>In the curve above we see that the optimum number of cluster selected is 4, despite the difference being relatively small compared to <code>ncluster = 2</code> and to the evolution with the number of segment. In addition, if we look at the results of the segmentation we can see identical segment distribution, the only difference is that state 2 in the segmentation with 3 cluster is divided into state 2 and 3 in the segmentation with 4 cluster:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mode_segclust</span>, ncluster <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="run_segclust2d_files/figure-html/3%20clusters-1.png" width="768"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mode_segclust</span>, ncluster <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p><img src="run_segclust2d_files/figure-html/4%20clusters-1.png" width="768"></p>
<p>More generally, as in this example, if the selected number of segment for a higher number of cluster is the same, then the lower number of cluster should be favored.</p>
<p>Once the number of cluster have been selected, the number of segment should be selected with the BIC criterium. When the segmentation-clustering is reliable, the selected optimum should the maximum just before a linear drop of the penalized log-Likelihood as in the examples above. With real data the signal is seldom as clear and may require adjustment based on exploration of the realized segmentation/clustering.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Remi Patin, Marie-Pierre Etienne, Emilie Lebarbier, Simon Benhamou.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
